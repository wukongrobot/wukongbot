# ğŸ”§ å›½äº§é¢‘é“æ˜¾ç¤ºä¿®å¤

## ğŸ› é—®é¢˜æè¿°

åœ¨è¿è¡Œ `pnpm wukongbot onboard` é…ç½®å‘å¯¼æ—¶ï¼Œé£ä¹¦ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡è¿™ä¸‰ä¸ªæ–°å¢çš„å›½äº§IMé¢‘é“æ²¡æœ‰åœ¨é¢‘é“é€‰æ‹©åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚

## ğŸ” é—®é¢˜åŸå› 

é¢‘é“æ’ä»¶éœ€è¦åœ¨ `package.json` ä¸­æ·»åŠ  `moltbot` é…ç½®èŠ‚ï¼Œç³»ç»Ÿæ‰èƒ½é€šè¿‡æ’ä»¶å‘ç°æœºåˆ¶æ‰¾åˆ°è¿™äº›é¢‘é“ã€‚

æ’ä»¶å‘ç°æµç¨‹ï¼š
1. `listChannelPluginCatalogEntries()` è°ƒç”¨ `discoverMoltbotPlugins()`
2. `discoverMoltbotPlugins()` æ‰«æå·¥ä½œåŒºä¸­çš„æ‰€æœ‰ package.json
3. æŸ¥æ‰¾åŒ…å« `moltbot.channel` é…ç½®çš„æ’ä»¶
4. å°†è¿™äº›æ’ä»¶æ·»åŠ åˆ°é¢‘é“é€‰æ‹©åˆ—è¡¨ä¸­

ä¹‹å‰åˆ›å»ºçš„ä¸‰ä¸ªæ’ä»¶åªæœ‰ `clawdbot.plugin.json`ï¼Œä½†ç¼ºå°‘ `package.json` ä¸­çš„ `moltbot` é…ç½®ã€‚

## âœ… ä¿®å¤å†…å®¹

### 1. é£ä¹¦æ’ä»¶ (`extensions/feishu/package.json`)

æ·»åŠ äº†å®Œæ•´çš„ `moltbot` é…ç½®ï¼š

```json
{
  "moltbot": {
    "channel": {
      "id": "feishu",
      "label": "é£ä¹¦",
      "selectionLabel": "é£ä¹¦ (Feishu/Lark)",
      "detailLabel": "é£ä¹¦ (Lark)",
      "blurb": "é£ä¹¦ä¼ä¸šåä½œå¹³å°",
      "docsPath": "/channels/feishu",
      "order": 50
    },
    "install": {
      "npmSpec": "clawdbot-plugin-feishu",
      "localPath": "../extensions/feishu",
      "defaultChoice": "local"
    }
  }
}
```

### 2. ä¼ä¸šå¾®ä¿¡æ’ä»¶ (`extensions/wecom/package.json`)

```json
{
  "moltbot": {
    "channel": {
      "id": "wecom",
      "label": "ä¼ä¸šå¾®ä¿¡",
      "selectionLabel": "ä¼ä¸šå¾®ä¿¡ (WeCom)",
      "detailLabel": "ä¼ä¸šå¾®ä¿¡ (WeCom)",
      "blurb": "ä¼ä¸šå¾®ä¿¡åŠå…¬å¹³å°",
      "docsPath": "/channels/wecom",
      "order": 51
    },
    "install": {
      "npmSpec": "clawdbot-plugin-wecom",
      "localPath": "../extensions/wecom",
      "defaultChoice": "local"
    }
  }
}
```

### 3. é’‰é’‰æ’ä»¶ (`extensions/dingtalk/package.json`)

```json
{
  "moltbot": {
    "channel": {
      "id": "dingtalk",
      "label": "é’‰é’‰",
      "selectionLabel": "é’‰é’‰ (DingTalk)",
      "detailLabel": "é’‰é’‰ (DingTalk)",
      "blurb": "é’‰é’‰æ™ºèƒ½ç§»åŠ¨åŠå…¬å¹³å°",
      "docsPath": "/channels/dingtalk",
      "order": 52
    },
    "install": {
      "npmSpec": "clawdbot-plugin-dingtalk",
      "localPath": "../extensions/dingtalk",
      "defaultChoice": "local"
    }
  }
}
```

## ğŸ“ é…ç½®è¯´æ˜

### `moltbot.channel` å­—æ®µ

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `id` | é¢‘é“å”¯ä¸€æ ‡è¯†ç¬¦ | `"feishu"` |
| `label` | é¢‘é“æ˜¾ç¤ºåç§° | `"é£ä¹¦"` |
| `selectionLabel` | é€‰æ‹©åˆ—è¡¨ä¸­çš„æ˜¾ç¤ºåç§° | `"é£ä¹¦ (Feishu/Lark)"` |
| `detailLabel` | è¯¦ç»†ä¿¡æ¯ä¸­çš„æ˜¾ç¤ºåç§° | `"é£ä¹¦ (Lark)"` |
| `blurb` | é¢‘é“ç®€çŸ­æè¿° | `"é£ä¹¦ä¼ä¸šåä½œå¹³å°"` |
| `docsPath` | æ–‡æ¡£è·¯å¾„ | `"/channels/feishu"` |
| `order` | æ’åºä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°è¶Šé å‰ï¼‰ | `50` |

### `moltbot.install` å­—æ®µ

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `npmSpec` | npm åŒ…åç§° | `"clawdbot-plugin-feishu"` |
| `localPath` | æœ¬åœ°ç›¸å¯¹è·¯å¾„ | `"../extensions/feishu"` |
| `defaultChoice` | é»˜è®¤å®‰è£…æ–¹å¼ | `"local"` (æœ¬åœ°) æˆ– `"npm"` |

### æ’åºä¼˜å…ˆçº§

è®¾ç½®çš„ `order` å€¼ï¼š
- é£ä¹¦: 50
- ä¼ä¸šå¾®ä¿¡: 51
- é’‰é’‰: 52

è¿™æ ·å¯ä»¥ç¡®ä¿è¿™ä¸‰ä¸ªå›½äº§é¢‘é“åœ¨åˆ—è¡¨ä¸­ç›¸é‚»æ˜¾ç¤ºï¼Œä¾¿äºç”¨æˆ·é€‰æ‹©ã€‚

## ğŸš€ æµ‹è¯•æ­¥éª¤

### 1. æ„å»ºé¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æ„å»ºï¼‰

```bash
cd /root/code/wukongbot
pnpm build
```

### 2. è¿è¡Œé…ç½®å‘å¯¼

```bash
pnpm wukongbot onboard
```

### 3. éªŒè¯é¢‘é“åˆ—è¡¨

åœ¨é…ç½®å‘å¯¼çš„é¢‘é“é€‰æ‹©æ­¥éª¤ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š

```
â—‡  Configure chat channels now?
   Yes

â—‡  Available channels:
   â€¢ WhatsApp Web
   â€¢ Telegram
   â€¢ Discord
   â€¢ Slack
   â€¢ Signal
   â€¢ iMessage
   â€¢ é£ä¹¦ (Feishu/Lark)        â† æ–°å¢
   â€¢ ä¼ä¸šå¾®ä¿¡ (WeCom)          â† æ–°å¢
   â€¢ é’‰é’‰ (DingTalk)           â† æ–°å¢
   ...
```

### 4. éªŒè¯æ’ä»¶å®‰è£…

ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡ŒéªŒè¯ï¼š

```bash
# æŸ¥çœ‹å¯ç”¨çš„é¢‘é“æ’ä»¶
pnpm wukongbot channels list

# æˆ–æŸ¥çœ‹æ’ä»¶ç›®å½•
pnpm wukongbot plugins list
```

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

```bash
pnpm wukongbot onboard
```

**é—®é¢˜**: é¢‘é“é€‰æ‹©åˆ—è¡¨ä¸­åªæ˜¾ç¤ºå†…ç½®é¢‘é“ï¼ˆWhatsAppã€Telegram ç­‰ï¼‰ï¼Œçœ‹ä¸åˆ°é£ä¹¦ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€‚

### ä¿®å¤å

```bash
pnpm wukongbot onboard
```

**æ•ˆæœ**: é¢‘é“é€‰æ‹©åˆ—è¡¨ä¸­æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰é¢‘é“ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªæ–°å¢çš„å›½äº§IMé¢‘é“ã€‚

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ’ä»¶å‘ç°æœºåˆ¶

ç³»ç»Ÿé€šè¿‡ä»¥ä¸‹æ–¹å¼å‘ç°é¢‘é“æ’ä»¶ï¼š

1. **æ ¸å¿ƒé¢‘é“**: é€šè¿‡ `src/channels/registry.ts` ä¸­çš„ `listChatChannels()` è·å–
2. **å·²å®‰è£…æ’ä»¶**: é€šè¿‡ `listChannelPlugins()` ä»è¿è¡Œæ—¶æ’ä»¶æ³¨å†Œè¡¨è·å–
3. **ç›®å½•æ’ä»¶**: é€šè¿‡ `listChannelPluginCatalogEntries()` æ‰«æå·¥ä½œåŒº

```typescript
// åœ¨ onboard-channels.ts ä¸­çš„å®ç°
const corePrimer = listChatChannels().map((meta) => ({
  id: meta.id as ChannelChoice,
  label: meta.label,
  blurb: meta.blurb,
}));

const primerChannels = [
  ...corePrimer,
  ...installedPlugins
    .filter((plugin) => !coreIds.has(plugin.id as ChannelChoice))
    .map((plugin) => ({
      id: plugin.id as ChannelChoice,
      label: plugin.meta.label,
      blurb: plugin.meta.blurb,
    })),
  ...catalogEntries  // â† é€šè¿‡ moltbot manifest å‘ç°çš„æ’ä»¶
    .filter((entry) => !coreIds.has(entry.id as ChannelChoice))
    .map((entry) => ({
      id: entry.id as ChannelChoice,
      label: entry.meta.label,
      blurb: entry.meta.blurb,
    })),
];
```

### ä¸ºä»€ä¹ˆéœ€è¦ `moltbot` é…ç½®

`clawdbot.plugin.json` æ˜¯æ’ä»¶è¿è¡Œæ—¶çš„å…ƒæ•°æ®ï¼Œç”¨äºæ’ä»¶åŠ è½½åçš„æ³¨å†Œã€‚

`package.json` ä¸­çš„ `moltbot` é…ç½®æ˜¯ç”¨äºæ’ä»¶å‘ç°é˜¶æ®µï¼Œè®©ç³»ç»Ÿåœ¨æ’ä»¶åŠ è½½å‰å°±çŸ¥é“æœ‰å“ªäº›å¯ç”¨çš„é¢‘é“æ’ä»¶ã€‚

ä¸¤è€…é…åˆä½¿ç”¨ï¼š
- `moltbot` manifest â†’ æ’ä»¶å‘ç° (ç¼–è¯‘å‰)
- `clawdbot.plugin.json` â†’ æ’ä»¶åŠ è½½ (è¿è¡Œæ—¶)

## ğŸ“ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶ (3ä¸ª)
1. `extensions/feishu/package.json`
2. `extensions/wecom/package.json`
3. `extensions/dingtalk/package.json`

### ç›¸å…³ä»£ç æ–‡ä»¶
- `src/channels/plugins/catalog.ts` - æ’ä»¶ç›®å½•å’Œå‘ç°
- `src/commands/onboard-channels.ts` - é¢‘é“é…ç½®å‘å¯¼
- `src/plugins/discovery.ts` - æ’ä»¶å‘ç°æœºåˆ¶

## ğŸ‰ æ€»ç»“

é€šè¿‡åœ¨ä¸‰ä¸ªå›½äº§IMæ’ä»¶çš„ `package.json` ä¸­æ·»åŠ  `moltbot.channel` é…ç½®ï¼Œè§£å†³äº†é…ç½®å‘å¯¼ä¸­æ— æ³•æ˜¾ç¤ºè¿™äº›é¢‘é“çš„é—®é¢˜ã€‚

ç°åœ¨ç”¨æˆ·å¯ä»¥åœ¨é…ç½®å‘å¯¼ä¸­ï¼š
- âœ… çœ‹åˆ°é£ä¹¦ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡é€‰é¡¹
- âœ… é€‰æ‹©å¹¶é…ç½®è¿™äº›å›½äº§IMé¢‘é“
- âœ… å®Œæ•´ä½“éªŒæ‚Ÿç©ºBotçš„å›½äº§åŒ–åŠŸèƒ½

---

**ä¿®å¤æ—¶é—´**: 2026-01-28  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶å¯æµ‹è¯•  
**æµ‹è¯•å‘½ä»¤**: `pnpm wukongbot onboard`
