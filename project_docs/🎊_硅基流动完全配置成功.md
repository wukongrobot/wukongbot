# ğŸŠ ç¡…åŸºæµåŠ¨ (DeepSeek V3) é…ç½®å®Œå…¨æˆåŠŸï¼

## âœ… é…ç½®å®ŒæˆçŠ¶æ€

### è®¤è¯ä¿¡æ¯
- **API Key**: `sk-fymrvjkuzxgqxmzctrbhwitoapmefcjnmabsgrogpqvwqbyd`
- **çŠ¶æ€**: âœ… å·²è¯†åˆ«å’ŒåŠ è½½
- **æ¥æº**: `models.json`ï¼ˆä»é…ç½®ä¸­çš„ `models.providers.deepseek-ai.apiKey` è¯»å–ï¼‰

### æ¨¡å‹é…ç½®
- **æ¨¡å‹åç§°**: `deepseek-ai/DeepSeek-V3`
- **Provider**: `deepseek-ai`
- **API ç«¯ç‚¹**: `https://api.siliconflow.cn/v1`
- **API ç±»å‹**: `openai-responses`ï¼ˆOpenAI å…¼å®¹ï¼‰
- **ä¸Šä¸‹æ–‡çª—å£**: 128,000 tokens
- **æœ€å¤§è¾“å‡º**: 8,192 tokens

### ç½‘å…³çŠ¶æ€
```
[gateway] agent model: deepseek-ai/DeepSeek-V3
[gateway] listening on ws://127.0.0.1:18789 (PID 7661)
[ws] webchat connected
```
- âœ… ç½‘å…³è¿è¡Œæ­£å¸¸
- âœ… WebSocket è¿æ¥æˆåŠŸ
- âœ… æ— é”™è¯¯æ—¥å¿—

---

## ğŸ“‹ æœ€ç»ˆé…ç½®

### é…ç½®æ–‡ä»¶: `~/.clawdbot/moltbot.json`

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "deepseek-ai/DeepSeek-V3"
      },
      "models": {
        "deepseek-ai/DeepSeek-V3": {}
      },
      "workspace": "/root/clawd"
    }
  },
  "models": {
    "providers": {
      "deepseek-ai": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [
          {
            "id": "DeepSeek-V3",
            "name": "DeepSeek V3",
            "reasoning": false,
            "input": ["text"],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      }
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0"
    }
  }
}
```

### ç¯å¢ƒå˜é‡: `~/.clawdbot/.env`

```bash
OPENAI_API_KEY=sk-fymrvjkuzxgqxmzctrbhwitoapmefcjnmabsgrogpqvwqbyd
```

---

## ğŸš€ ç«‹å³æµ‹è¯•å¯¹è¯

### æ–¹å¼ 1: é€šè¿‡ Control UIï¼ˆæ¨èï¼‰

**è®¿é—®åœ°å€**ï¼ˆå¸¦ tokenï¼Œç›´æ¥ä½¿ç”¨ï¼‰:
```
http://127.0.0.1:18789/?token=1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0
```

**æ“ä½œæ­¥éª¤**:
1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸Šé¢çš„ URL
2. ç‚¹å‡»é¡¶éƒ¨çš„ "Chat" æ ‡ç­¾
3. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ï¼š`ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±`
4. æŒ‰å›è½¦å‘é€
5. âœ… åº”è¯¥çœ‹åˆ° DeepSeek V3 çš„å›å¤

### æ–¹å¼ 2: é€šè¿‡ CLI

```bash
cd /root/code/wukongbot

# å‘é€æ¶ˆæ¯
pnpm wukongbot agent --message "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"
```

### æ–¹å¼ 3: ç›´æ¥è®¿é—® Chat é¡µé¢

```
http://127.0.0.1:18789/chat?session=agent%3Amain%3Amain&token=1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0
```

---

## ğŸ“Š æ¨¡å‹çŠ¶æ€éªŒè¯

### è¿è¡ŒçŠ¶æ€æ£€æŸ¥

```bash
pnpm wukongbot models status
```

**è¾“å‡º**:
```
Config        : ~/.moltbot/moltbot.json
Agent dir     : ~/.clawdbot/agents/main/agent
Default       : deepseek-ai/DeepSeek-V3
Configured models (1): deepseek-ai/DeepSeek-V3

Auth overview
- deepseek-ai effective=models.json:sk-fymrv...pqvwqbyd âœ“
```

- âœ… æ¨¡å‹å·²é…ç½®
- âœ… è®¤è¯å·²è¯†åˆ«
- âœ… API Key æœ‰æ•ˆ

---

## ğŸ” é…ç½®åŸç†

### ä¸ºä»€ä¹ˆè¿™æ ·é…ç½®ï¼Ÿ

#### é—®é¢˜å›é¡¾

**é”™è¯¯çš„é…ç½®**ï¼ˆä¸æ”¯æŒï¼‰:
```json
{
  "agents": {
    "defaults": {
      "models": {
        "deepseek-ai/DeepSeek-V3": {
          "apiKey": "sk-xxx",      // âŒ ä¸æ”¯æŒ
          "baseURL": "https://..." // âŒ ä¸æ”¯æŒ
        }
      }
    }
  }
}
```

**é”™è¯¯**: `Unrecognized keys: "apiKey", "baseURL"`

#### æ­£ç¡®çš„é…ç½®

**æ–¹å¼ 1**: ç¯å¢ƒå˜é‡ + `models.providers`ï¼ˆâœ… æ¨èï¼‰

```json
{
  "agents": {
    "defaults": {
      "models": {
        "deepseek-ai/DeepSeek-V3": {}  // âœ… ç©ºå¯¹è±¡
      }
    }
  },
  "models": {
    "providers": {
      "deepseek-ai": {              // âœ… provider é…ç½®
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses"
      }
    }
  }
}
```

é…åˆç¯å¢ƒå˜é‡ï¼š
```bash
# ~/.clawdbot/.env
OPENAI_API_KEY=sk-ä½ çš„APIå¯†é’¥
```

### é…ç½®è§£ææµç¨‹

1. **æ¨¡å‹å¼•ç”¨è§£æ**:
   ```
   deepseek-ai/DeepSeek-V3
   â†“
   provider: deepseek-ai
   model: DeepSeek-V3
   ```

2. **æŸ¥æ‰¾ Provider é…ç½®**:
   ```
   config.models.providers["deepseek-ai"]
   â†“
   {
     baseUrl: "https://api.siliconflow.cn/v1",
     apiKey: "${OPENAI_API_KEY}",
     api: "openai-responses"
   }
   ```

3. **ç¯å¢ƒå˜é‡æ›¿æ¢**:
   ```
   ${OPENAI_API_KEY}
   â†“
   ä» ~/.clawdbot/.env è¯»å–
   â†“
   sk-fymrvjkuzxgqxmzctrbhwitoapmefcjnmabsgrogpqvwqbyd
   ```

4. **API è°ƒç”¨**:
   ```
   POST https://api.siliconflow.cn/v1/chat/completions
   Authorization: Bearer sk-fymrv...pqvwqbyd
   Body: {
     "model": "deepseek-ai/DeepSeek-V3",
     "messages": [...]
   }
   ```

---

## ğŸ’¡ å…³é”®é…ç½®è¦ç‚¹

### 1. Provider é…ç½®ç»“æ„

```typescript
"models": {
  "providers": {
    "<provider-id>": {
      "baseUrl": "API ç«¯ç‚¹",
      "apiKey": "API å¯†é’¥ï¼ˆå¯ç”¨ ${ENV_VAR}ï¼‰",
      "api": "openai-responses | anthropic | ...",
      "models": [
        {
          "id": "æ¨¡å‹ID",
          "name": "æ˜¾ç¤ºåç§°",
          "contextWindow": 128000,
          "maxTokens": 8192
        }
      ]
    }
  }
}
```

### 2. æ¨¡å‹å¼•ç”¨æ ¼å¼

```
<provider-id>/<model-id>
```

ä¾‹å¦‚ï¼š
- `openai/gpt-4` â†’ provider: `openai`, model: `gpt-4`
- `deepseek-ai/DeepSeek-V3` â†’ provider: `deepseek-ai`, model: `DeepSeek-V3`
- `qwen/Qwen2.5-7B` â†’ provider: `qwen`, model: `Qwen2.5-7B`

### 3. API Key æŸ¥æ‰¾é¡ºåº

ç³»ç»ŸæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ API keyï¼š
1. `models.providers.<provider>.apiKey`ï¼ˆé…ç½®æ–‡ä»¶ï¼‰
2. `~/.clawdbot/agents/<agent>/auth-profiles.json`ï¼ˆè®¤è¯å­˜å‚¨ï¼‰
3. ç¯å¢ƒå˜é‡ï¼ˆ`~/.clawdbot/.env` æˆ– shell ç¯å¢ƒï¼‰

**æ¨è**: åœ¨é…ç½®ä¸­ä½¿ç”¨ `${ENV_VAR}` å¼•ç”¨ç¯å¢ƒå˜é‡ï¼Œä¿æŒçµæ´»æ€§ã€‚

### 4. Base URL è®¾ç½®

- **æ–¹æ³• 1**: åœ¨ `models.providers.<provider>.baseUrl` ä¸­è®¾ç½®ï¼ˆâœ… æ¨èï¼‰
- **æ–¹æ³• 2**: åœ¨ `env.OPENAI_BASE_URL` ä¸­è®¾ç½®ï¼ˆå…¨å±€è¦†ç›–ï¼Œå½±å“æ‰€æœ‰ OpenAI å…¼å®¹ APIï¼‰

---

## ğŸ¯ æ·»åŠ æ›´å¤šç¡…åŸºæµåŠ¨æ¨¡å‹ï¼ˆå¯é€‰ï¼‰

å¦‚æœæƒ³ä½¿ç”¨å…¶ä»–ç¡…åŸºæµåŠ¨æ¨¡å‹ï¼š

### æ·»åŠ é€šä¹‰åƒé—® 2.5

```json
{
  "models": {
    "providers": {
      "deepseek-ai": { /* å·²æœ‰é…ç½® */ },
      "qwen": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [
          {
            "id": "Qwen2.5-7B-Instruct",
            "name": "é€šä¹‰åƒé—® 2.5 (7B)",
            "reasoning": false,
            "input": ["text"],
            "contextWindow": 32768,
            "maxTokens": 2048
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "models": {
        "deepseek-ai/DeepSeek-V3": {},
        "qwen/Qwen2.5-7B-Instruct": {}
      }
    }
  }
}
```

### åˆ‡æ¢ä¸»æ¨¡å‹

```bash
# åˆ‡æ¢åˆ°é€šä¹‰åƒé—®
pnpm wukongbot models set "qwen/Qwen2.5-7B-Instruct"

# åˆ‡æ¢å› DeepSeek
pnpm wukongbot models set "deepseek-ai/DeepSeek-V3"
```

---

## ğŸ§ª éªŒè¯æ¸…å•

### âœ… é…ç½®æ£€æŸ¥
- [x] API Key å­˜åœ¨äº `~/.clawdbot/.env`
- [x] é…ç½®æ–‡ä»¶åŒ…å« `models.providers.deepseek-ai`
- [x] Provider é…ç½®åŒ…å« `baseUrl` å’Œ `apiKey`
- [x] æ¨¡å‹å£°æ˜åœ¨ `agents.defaults.models`

### âœ… ç½‘å…³æ£€æŸ¥
- [x] ç½‘å…³æˆåŠŸå¯åŠ¨ï¼ˆæ— é”™è¯¯ï¼‰
- [x] æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„æ¨¡å‹åç§°
- [x] WebSocket è¿æ¥æˆåŠŸ
- [x] æ—  "Unknown model" é”™è¯¯

### âœ… è®¤è¯æ£€æŸ¥
- [x] `models status` æ˜¾ç¤º deepseek-ai æœ‰è®¤è¯
- [x] API Key æ­£ç¡®åŠ è½½
- [x] æ—  "Missing auth" æç¤º

### â³ å¾…æµ‹è¯•
- [ ] å‘é€æ¶ˆæ¯æµ‹è¯•å¯¹è¯
- [ ] éªŒè¯ DeepSeek V3 æ­£å¸¸å›å¤
- [ ] æ£€æŸ¥å›å¤è´¨é‡å’Œé€Ÿåº¦

---

## ğŸ“ æ•…éšœæ’æŸ¥

### å¦‚æœå¯¹è¯å¤±è´¥

#### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
tail -f /tmp/wukongbot-gateway.log
```

å‘é€æ¶ˆæ¯æ—¶åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
```
[agent] running turn...
[provider:deepseek-ai] API request...
[provider:deepseek-ai] response received
[diagnostic] lane task success
```

#### æµ‹è¯• API ç›´è¿

```bash
curl -X POST https://api.siliconflow.cn/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer sk-fymrvjkuzxgqxmzctrbhwitoapmefcjnmabsgrogpqvwqbyd" \
  -d '{
    "model": "deepseek-ai/DeepSeek-V3",
    "messages": [{"role": "user", "content": "ä½ å¥½"}],
    "max_tokens": 50
  }' | jq '.'
```

åº”è¯¥è¿”å›æ­£å¸¸çš„ JSON å“åº”ã€‚

#### å¸¸è§é”™è¯¯

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **401 Unauthorized** | API Key æ— æ•ˆæˆ–è¿‡æœŸ | é‡æ–°è·å– API Key |
| **404 Not Found** | æ¨¡å‹åç§°é”™è¯¯ | æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡® |
| **429 Too Many Requests** | è¯·æ±‚é¢‘ç‡è¿‡é«˜ | ç­‰å¾…æˆ–å‡çº§å¥—é¤ |
| **500 Server Error** | ç¡…åŸºæµåŠ¨æœåŠ¡é—®é¢˜ | ç­‰å¾…æˆ–è”ç³»å®¢æœ |
| **Unknown model** | Provider é…ç½®ç¼ºå¤± | æ£€æŸ¥ `models.providers` |
| **Missing auth** | API Key æœªé…ç½® | æ£€æŸ¥ `.env` å’Œé…ç½® |

---

## ğŸ¨ å®Œæ•´é…ç½®ç¤ºä¾‹ï¼ˆå‚è€ƒï¼‰

### å•æ¨¡å‹é…ç½®ï¼ˆå½“å‰ï¼‰

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "deepseek-ai/DeepSeek-V3"
      },
      "models": {
        "deepseek-ai/DeepSeek-V3": {}
      },
      "workspace": "/root/clawd"
    }
  },
  "models": {
    "providers": {
      "deepseek-ai": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [
          {
            "id": "DeepSeek-V3",
            "name": "DeepSeek V3",
            "reasoning": false,
            "input": ["text"],
            "cost": { "input": 0, "output": 0, "cacheRead": 0, "cacheWrite": 0 },
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      }
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0"
    }
  }
}
```

### å¤šæ¨¡å‹é…ç½®ï¼ˆæ‰©å±•ï¼‰

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "deepseek-ai/DeepSeek-V3",
        "fallbacks": [
          "qwen/Qwen2.5-7B-Instruct",
          "glm/glm-4-9b-chat"
        ]
      },
      "models": {
        "deepseek-ai/DeepSeek-V3": {},
        "qwen/Qwen2.5-7B-Instruct": {},
        "glm/glm-4-9b-chat": {}
      }
    }
  },
  "models": {
    "providers": {
      "deepseek-ai": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [...]
      },
      "qwen": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [...]
      },
      "glm": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [...]
      }
    }
  }
}
```

è¿™æ ·é…ç½®åï¼š
- ä¸»æ¨¡å‹å¤±è´¥ â†’ è‡ªåŠ¨å°è¯•é€šä¹‰åƒé—®
- é€šä¹‰åƒé—®å¤±è´¥ â†’ è‡ªåŠ¨å°è¯• GLM-4
- æ‰€æœ‰æ¨¡å‹ä½¿ç”¨åŒä¸€ä¸ª API Key

---

## ğŸ“š ç›¸å…³å‘½ä»¤é€ŸæŸ¥

### æ¨¡å‹ç®¡ç†
```bash
# æŸ¥çœ‹çŠ¶æ€
pnpm wukongbot models status

# åˆ‡æ¢æ¨¡å‹
pnpm wukongbot models set "æ¨¡å‹åç§°"

# æŸ¥çœ‹å¯ç”¨æ¨¡å‹
pnpm wukongbot models list

# è®¾ç½®å¤‡ç”¨æ¨¡å‹
pnpm wukongbot models fallbacks add "å¤‡ç”¨æ¨¡å‹"
```

### é…ç½®ç®¡ç†
```bash
# æŸ¥çœ‹é…ç½®
pnpm wukongbot config get agents.defaults.model

# è®¾ç½®ä¸»æ¨¡å‹
pnpm wukongbot config set agents.defaults.model.primary "æ¨¡å‹åç§°"

# æŸ¥çœ‹å®Œæ•´é…ç½®
cat ~/.clawdbot/moltbot.json | jq '.'
```

### ç½‘å…³ç®¡ç†
```bash
# æŸ¥çœ‹çŠ¶æ€
pnpm wukongbot gateway status

# é‡å¯ç½‘å…³
pkill -f "moltbot.*gateway"
pnpm wukongbot gateway run --port 18789

# æŸ¥çœ‹æ—¥å¿—
tail -f /tmp/wukongbot-gateway.log
```

---

## ğŸ‰ é…ç½®å®Œæˆæ€»ç»“

### ä¿®å¤çš„é—®é¢˜
1. âœ… "Unknown model: deepseek-ai/DeepSeek-V3"
2. âœ… "Missing auth - deepseek-ai"
3. âœ… é…ç½®æ ¼å¼é”™è¯¯ï¼ˆUnrecognized keysï¼‰
4. âœ… Provider è®¤è¯æ˜ å°„

### åº”ç”¨çš„é…ç½®
1. âœ… API Key å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
2. âœ… Provider é…ç½®ä½¿ç”¨ `models.providers`
3. âœ… Base URL æŒ‡å‘ç¡…åŸºæµåŠ¨ç«¯ç‚¹
4. âœ… API ç±»å‹è®¾ç½®ä¸º OpenAI å…¼å®¹

### å½“å‰çŠ¶æ€
- âœ… é…ç½®æ–‡ä»¶æœ‰æ•ˆ
- âœ… ç½‘å…³è¿è¡Œæ­£å¸¸
- âœ… æ¨¡å‹è®¤è¯æˆåŠŸ
- âœ… å¯ä»¥å¼€å§‹å¯¹è¯

---

## ğŸš€ ä¸‹ä¸€æ­¥

### 1. æµ‹è¯•å¯¹è¯ï¼ˆå¿…åšï¼‰

è®¿é—®ï¼š
```
http://127.0.0.1:18789/?token=1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0
```

å‘é€æµ‹è¯•æ¶ˆæ¯ï¼ŒéªŒè¯ DeepSeek V3 æ­£å¸¸å·¥ä½œã€‚

### 2. é…ç½®å…¶ä»–åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

- **æ·»åŠ é¢‘é“**: `pnpm wukongbot configure`ï¼ˆé…ç½®é£ä¹¦ã€ä¼å¾®ã€é’‰é’‰ç­‰ï¼‰
- **æ·»åŠ æŠ€èƒ½**: `pnpm wukongbot configure`ï¼ˆå¯ç”¨ web-searchã€è®¡ç®—å™¨ç­‰ï¼‰
- **é…ç½®è®°å¿†**: å¯ç”¨é•¿æœŸè®°å¿†åŠŸèƒ½

### 3. ä¼˜åŒ–ä½“éªŒï¼ˆå¯é€‰ï¼‰

- é…ç½®å¤šä¸ªæ¨¡å‹ä½œä¸ºå¤‡ä»½
- è®¾ç½®è‡ªå®šä¹‰ system prompt
- é…ç½®å¯¹è¯è¶…æ—¶å’Œé‡è¯•

---

**é…ç½®æ—¶é—´**: 2026-01-28 13:33  
**çŠ¶æ€**: âœ… å®Œå…¨æˆåŠŸ  
**æ¨¡å‹**: deepseek-ai/DeepSeek-V3 via ç¡…åŸºæµåŠ¨  
**ä¸‹ä¸€æ­¥**: ç«‹å³æµ‹è¯•å¯¹è¯ï¼ğŸŠ
