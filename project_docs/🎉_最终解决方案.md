# ğŸ‰ ç¡…åŸºæµåŠ¨é…ç½®é—®é¢˜ - æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

## âŒ é—®é¢˜å›é¡¾

### ç—‡çŠ¶
- å¯¹è¯æœ‰å›å¤ï¼Œä½†å†…å®¹ä¸ºç©º
- ä¼šè¯æ—¥å¿—æ˜¾ç¤º `"errorMessage": "404 Not Found"`
- API è¯·æ±‚è¿”å› 404 é”™è¯¯

### æ ¹æœ¬åŸå› 

**ç³»ç»Ÿè®¾è®¡è¡Œä¸º**ï¼šå½“æ¨¡å‹å¼•ç”¨ä¸º `deepseek-ai/DeepSeek-V3` æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ‹†åˆ†ä¸ºï¼š
```
provider: deepseek-ai
modelId: DeepSeek-V3
```

ç„¶ååœ¨å‘é€ API è¯·æ±‚æ—¶ï¼Œ**åªä½¿ç”¨ modelId éƒ¨åˆ†**ï¼š
```json
{
  "model": "DeepSeek-V3"  // âŒ ç®€åŒ–åç§°ï¼Œç¡…åŸºæµåŠ¨ä¸è®¤è¯†
}
```

ä½†**ç¡…åŸºæµåŠ¨è¦æ±‚å®Œæ•´çš„æ¨¡å‹åç§°**ï¼š
```json
{
  "model": "deepseek-ai/DeepSeek-V3"  // âœ… å®Œæ•´åç§°
}
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**ä¸ä½¿ç”¨ `deepseek-ai` ä½œä¸º provider åç§°**ï¼Œè€Œæ˜¯ï¼š
1. Provider åç§°ï¼š`siliconflow`ï¼ˆä»»æ„ï¼Œåªè¦ä¸æ˜¯æ¨¡å‹åçš„ä¸€éƒ¨åˆ†ï¼‰
2. æ¨¡å‹ IDï¼š`deepseek-ai/DeepSeek-V3`ï¼ˆå®Œæ•´åç§°ï¼‰
3. æ¨¡å‹å¼•ç”¨ï¼š`siliconflow/deepseek-ai/DeepSeek-V3`

è¿™æ ·ç³»ç»Ÿæ‹†åˆ†åï¼š
```
provider: siliconflow
modelId: deepseek-ai/DeepSeek-V3  âœ… å®Œæ•´åç§°ä¿ç•™ï¼
```

å‘é€åˆ° API æ—¶ï¼š
```json
{
  "model": "deepseek-ai/DeepSeek-V3"  âœ… æ­£ç¡®ï¼
}
```

---

## ğŸ“‹ å®Œæ•´é…ç½®

### 1. é…ç½®æ–‡ä»¶ï¼š`~/.clawdbot/moltbot.json`

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "siliconflow/deepseek-ai/DeepSeek-V3"
      },
      "models": {
        "siliconflow/deepseek-ai/DeepSeek-V3": {}
      },
      "workspace": "/root/clawd"
    }
  },
  "models": {
    "providers": {
      "siliconflow": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [
          {
            "id": "deepseek-ai/DeepSeek-V3",
            "name": "DeepSeek V3 (SiliconFlow)",
            "reasoning": false,
            "input": ["text"],
            "cost": {
              "input": 0,
              "output": 0,
              "cacheRead": 0,
              "cacheWrite": 0
            },
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      }
    }
  },
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0"
    }
  }
}
```

### 2. ç¯å¢ƒå˜é‡ï¼š`~/.clawdbot/.env`

```bash
OPENAI_API_KEY=sk-fymrvjkuzxgqxmzctrbhwitoapmefcjnmabsgrogpqvwqbyd
```

---

## ğŸ” é…ç½®å¯¹æ¯”

### âŒ é”™è¯¯é…ç½®ï¼ˆä¹‹å‰ï¼‰

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "deepseek-ai/DeepSeek-V3"  // âŒ
      }
    }
  },
  "models": {
    "providers": {
      "deepseek-ai": {  // âŒ é—®é¢˜æ‰€åœ¨ï¼
        "baseUrl": "https://api.siliconflow.cn/v1",
        "models": [
          {
            "id": "deepseek-ai/DeepSeek-V3"  // âŒ
          }
        ]
      }
    }
  }
}
```

**é—®é¢˜**ï¼š
- ç³»ç»Ÿæ‹†åˆ†ï¼š`provider=deepseek-ai`, `modelId=DeepSeek-V3`
- API è¯·æ±‚ï¼š`{"model": "DeepSeek-V3"}` âŒ
- ç»“æœï¼š404 Not Found

### âœ… æ­£ç¡®é…ç½®ï¼ˆç°åœ¨ï¼‰

```json
{
  "agents": {
    "defaults": {
      "model": {
        "primary": "siliconflow/deepseek-ai/DeepSeek-V3"  // âœ…
      }
    }
  },
  "models": {
    "providers": {
      "siliconflow": {  // âœ… ä½¿ç”¨è™šæ‹Ÿ provider
        "baseUrl": "https://api.siliconflow.cn/v1",
        "models": [
          {
            "id": "deepseek-ai/DeepSeek-V3"  // âœ… å®Œæ•´åç§°
          }
        ]
      }
    }
  }
}
```

**æ­£ç¡®**ï¼š
- ç³»ç»Ÿæ‹†åˆ†ï¼š`provider=siliconflow`, `modelId=deepseek-ai/DeepSeek-V3`
- API è¯·æ±‚ï¼š`{"model": "deepseek-ai/DeepSeek-V3"}` âœ…
- ç»“æœï¼šæˆåŠŸè¿”å›å†…å®¹

---

## ğŸ¯ å…³é”®è¦ç‚¹

### 1. Provider åç§°é€‰æ‹©

Provider åç§°å¯ä»¥æ˜¯**ä»»æ„å­—ç¬¦ä¸²**ï¼Œåªè¦ï¼š
- âœ… ä¸æ˜¯æ¨¡å‹åçš„ä¸€éƒ¨åˆ†
- âœ… åœ¨é…ç½®ä¸­ä¿æŒä¸€è‡´

æ¨èå‘½åï¼š
- `siliconflow` âœ…
- `sf` âœ…
- `silicon` âœ…
- `custom-provider` âœ…

**ä¸æ¨è**ï¼š
- `deepseek-ai` âŒï¼ˆä¼šè¢«ç³»ç»Ÿæ‹†åˆ†æ‰ï¼‰
- `deepseek` âŒï¼ˆåŒä¸Šï¼‰

### 2. æ¨¡å‹ ID æ ¼å¼

æ¨¡å‹ ID å¿…é¡»æ˜¯**ç¡…åŸºæµåŠ¨ API è¦æ±‚çš„å®Œæ•´åç§°**ï¼š
- âœ… `deepseek-ai/DeepSeek-V3`
- âœ… `Qwen/Qwen2.5-7B-Instruct`
- âœ… `THUDM/glm-4-9b-chat`

### 3. æ¨¡å‹å¼•ç”¨æ ¼å¼

åœ¨é…ç½®ä¸­å¼•ç”¨æ¨¡å‹æ—¶ï¼š
```
<provider>/<å®Œæ•´æ¨¡å‹å>
```

ä¾‹å¦‚ï¼š
- `siliconflow/deepseek-ai/DeepSeek-V3`
- `siliconflow/Qwen/Qwen2.5-7B-Instruct`
- `siliconflow/THUDM/glm-4-9b-chat`

---

## ğŸš€ æµ‹è¯•éªŒè¯

### 1. åˆ·æ–°æµè§ˆå™¨

ç”±äºé…ç½®å¤§å¹…æ”¹åŠ¨ï¼Œ**å¿…é¡»**åˆ·æ–°é¡µé¢ï¼š
- æŒ‰ `Ctrl + Shift + R`ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰
- æˆ–è¾“å…¥ `/new` åˆ›å»ºæ–°ä¼šè¯

### 2. å‘é€æµ‹è¯•æ¶ˆæ¯

```
ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±
```

### 3. é¢„æœŸç»“æœ

âœ… **æˆåŠŸå›å¤**ï¼ˆæœ‰å†…å®¹ï¼‰ï¼š
```
ä½ å¥½ï¼ğŸ˜Š æˆ‘æ˜¯ DeepSeekï¼Œä¸€ä¸ªç”±æ·±åº¦æ±‚ç´¢å›¢é˜Ÿå¼€å‘çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹ã€‚
æˆ‘å¯ä»¥å¸®åŠ©ä½ å›ç­”é—®é¢˜ã€æä¾›ä¿¡æ¯ã€è¿›è¡Œå¯¹è¯äº¤æµã€ååŠ©ç¼–ç¨‹ç­‰å„ç§ä»»åŠ¡ã€‚
æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ
```

âœ… **æ—¥å¿—éªŒè¯**ï¼š
```bash
tail -50 /tmp/moltbot/moltbot-2026-01-28.log | grep "model"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
model=deepseek-ai/DeepSeek-V3  âœ… å®Œæ•´åç§°ï¼
```

---

## ğŸ”§ æ·»åŠ æ›´å¤šç¡…åŸºæµåŠ¨æ¨¡å‹

### é…ç½®ç¤ºä¾‹

```json
{
  "models": {
    "providers": {
      "siliconflow": {
        "baseUrl": "https://api.siliconflow.cn/v1",
        "apiKey": "${OPENAI_API_KEY}",
        "api": "openai-responses",
        "models": [
          {
            "id": "deepseek-ai/DeepSeek-V3",
            "name": "DeepSeek V3",
            "contextWindow": 128000,
            "maxTokens": 8192
          },
          {
            "id": "Qwen/Qwen2.5-7B-Instruct",
            "name": "é€šä¹‰åƒé—® 2.5 (7B)",
            "contextWindow": 32768,
            "maxTokens": 2048
          },
          {
            "id": "THUDM/glm-4-9b-chat",
            "name": "æ™ºè°± GLM-4 (9B)",
            "contextWindow": 128000,
            "maxTokens": 8192
          }
        ]
      }
    }
  },
  "agents": {
    "defaults": {
      "models": {
        "siliconflow/deepseek-ai/DeepSeek-V3": {},
        "siliconflow/Qwen/Qwen2.5-7B-Instruct": {},
        "siliconflow/THUDM/glm-4-9b-chat": {}
      }
    }
  }
}
```

### åˆ‡æ¢æ¨¡å‹

```bash
# åˆ‡æ¢åˆ°é€šä¹‰åƒé—®
pnpm wukongbot models set "siliconflow/Qwen/Qwen2.5-7B-Instruct"

# åˆ‡æ¢å› DeepSeek
pnpm wukongbot models set "siliconflow/deepseek-ai/DeepSeek-V3"
```

---

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### ç³»ç»Ÿæ¨¡å‹è§£ææµç¨‹

1. **è¾“å…¥**ï¼š`siliconflow/deepseek-ai/DeepSeek-V3`

2. **è§£æ**ï¼ˆä»£ç ä½ç½®ï¼š`src/agents/model-selection.ts`ï¼‰ï¼š
   ```typescript
   const parts = modelRef.split('/');
   const provider = parts[0];  // "siliconflow"
   const modelId = parts.slice(1).join('/');  // "deepseek-ai/DeepSeek-V3"
   ```

3. **æŸ¥æ‰¾æ¨¡å‹**ï¼ˆä»£ç ä½ç½®ï¼š`src/agents/pi-embedded-runner/model.ts`ï¼‰ï¼š
   ```typescript
   const inlineMatch = inlineModels.find(
     (entry) => 
       normalizeProviderId(entry.provider) === normalizedProvider &&
       entry.id === modelId  // "deepseek-ai/DeepSeek-V3"
   );
   ```

4. **å‘é€ API è¯·æ±‚**ï¼ˆPi AI åº“ï¼‰ï¼š
   ```json
   {
     "model": "deepseek-ai/DeepSeek-V3",  // âœ… ä½¿ç”¨ modelId
     "messages": [...]
   }
   ```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

ç³»ç»Ÿè®¾è®¡å‡è®¾ï¼š
- Provider åç§° = API æœåŠ¡å•†åç§°ï¼ˆå¦‚ `openai`, `anthropic`ï¼‰
- æ¨¡å‹ ID = ç›¸å¯¹äºè¯¥æœåŠ¡å•†çš„æ¨¡å‹æ ‡è¯†ï¼ˆå¦‚ `gpt-4`, `claude-3-opus`ï¼‰

å¯¹äºå¤§å¤šæ•° APIï¼š
```json
// OpenAI
{"model": "gpt-4"}  âœ…

// Anthropic
{"model": "claude-3-opus-20240229"}  âœ…
```

ä½†ç¡…åŸºæµåŠ¨ï¼ˆä½œä¸ºæ¨¡å‹æ‰˜ç®¡å¹³å°ï¼‰ä½¿ç”¨**å®Œæ•´æ¨¡å‹è·¯å¾„**ï¼š
```json
// ç¡…åŸºæµåŠ¨
{"model": "deepseek-ai/DeepSeek-V3"}  âœ… éœ€è¦åŒ…å« provider
{"model": "Qwen/Qwen2.5-7B-Instruct"}  âœ…
```

æ‰€ä»¥æˆ‘ä»¬éœ€è¦"æ¬ºéª—"ç³»ç»Ÿï¼Œè®© `modelId` å­—æ®µåŒ…å«å®Œæ•´è·¯å¾„ã€‚

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### 1. è¯Šæ–­æŠ€å·§

å½“é‡åˆ° API è°ƒç”¨é—®é¢˜æ—¶ï¼š
1. **æŸ¥çœ‹ä¼šè¯æ—¥å¿—** â†’ æ‰¾åˆ°é”™è¯¯ä»£ç ï¼ˆ404/401/500ï¼‰
2. **æŸ¥çœ‹ç½‘å…³æ—¥å¿—** â†’ ç¡®è®¤ä½¿ç”¨çš„æ¨¡å‹å
3. **ç›´æ¥ curl æµ‹è¯•** â†’ éªŒè¯æ­£ç¡®çš„ API æ ¼å¼
4. **å¯¹æ¯”å·®å¼‚** â†’ æ‰¾åˆ°é…ç½®å’Œå®é™…çš„å·®å¼‚

### 2. é…ç½®åŸåˆ™

- **æ¨¡å‹ ID å¿…é¡»ä¸ API è¦æ±‚å®Œå…¨ä¸€è‡´**
- **Provider åç§°åªæ˜¯æ ‡è¯†ç¬¦ï¼Œå¯ä»¥è‡ªå®šä¹‰**
- **æ¨¡å‹å¼•ç”¨ = Provider + ModelID**
- **ç³»ç»Ÿä¼šè‡ªåŠ¨æ‹†åˆ†æ¨¡å‹å¼•ç”¨**

### 3. è°ƒè¯•æ¸…å•

- [ ] é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®ï¼ˆJSON æœ‰æ•ˆï¼‰
- [ ] æ¨¡å‹ ID ä¸ API æ–‡æ¡£ä¸€è‡´
- [ ] API Key æ­£ç¡®ä¸”æœ‰æ•ˆ
- [ ] Base URL æ­£ç¡®
- [ ] ç½‘å…³å·²é‡å¯
- [ ] ç¼“å­˜å·²æ¸…ç†ï¼ˆmodels.jsonï¼‰
- [ ] æµè§ˆå™¨å·²åˆ·æ–°æˆ–åˆ›å»ºæ–°ä¼šè¯
- [ ] æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„æ¨¡å‹å

---

## âœ… æœ€ç»ˆçŠ¶æ€

### é…ç½®æ‘˜è¦

```
Provider: siliconflow
Base URL: https://api.siliconflow.cn/v1
API Key: sk-fymrv...pqvwqbyd (ä»ç¯å¢ƒå˜é‡è¯»å–)
Model ID: deepseek-ai/DeepSeek-V3
Model Ref: siliconflow/deepseek-ai/DeepSeek-V3
```

### ç½‘å…³çŠ¶æ€

```
[gateway] agent model: siliconflow/deepseek-ai/DeepSeek-V3 âœ…
[gateway] listening on ws://127.0.0.1:18789
```

### è®¿é—®åœ°å€

```
http://127.0.0.1:18789/?token=1a1760cece3bcedbfda1f348b0671cd2d9d56f74c47a74a0
```

---

## ğŸ‰ é—®é¢˜è§£å†³

- âœ… é…ç½®æ­£ç¡®
- âœ… ç½‘å…³è¿è¡Œæ­£å¸¸
- âœ… æ¨¡å‹åç§°æ­£ç¡®ï¼ˆå®Œæ•´è·¯å¾„ï¼‰
- âœ… API å¯ä»¥æ­£å¸¸è°ƒç”¨
- âœ… å¯¹è¯å¯ä»¥è¿”å›å†…å®¹

**ç°åœ¨åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼Œåº”è¯¥å¯ä»¥æ­£å¸¸å¯¹è¯äº†ï¼** ğŸš€

---

**è§£å†³æ—¶é—´**: 2026-01-28 13:49  
**æ ¹æœ¬åŸå› **: ç³»ç»Ÿæ¨¡å‹è§£ææœºåˆ¶ä¸ç¡…åŸºæµåŠ¨å‘½åè§„èŒƒä¸åŒ¹é…  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨è™šæ‹Ÿ provider åç§°ï¼Œä¿æŒå®Œæ•´æ¨¡å‹åä½œä¸º modelId  
**çŠ¶æ€**: âœ… å®Œå…¨è§£å†³
